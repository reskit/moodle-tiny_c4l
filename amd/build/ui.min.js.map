{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny C4L UI.\n *\n * @module      tiny_c4l/ui\n * @copyright   2022 Marc Catal√† <reskit@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {component} from './common';\nimport C4LModal from './modal';\nimport ModalFactory from 'core/modal_factory';\nimport {components as Components} from './components';\nimport {get_strings as getStrings} from 'core/str';\nimport {\n    isStudent,\n    getallowedComponents,\n    showPreview\n} from './options';\nimport ModalEvents from 'core/modal_events';\nimport {\n    addVariant,\n    getVariants,\n    loadVariantPreferences,\n    removeVariant,\n    saveVariantPreferences,\n    variantExists\n} from './variants';\n\nlet userStudent = false;\nlet previewC4L = true;\nlet allowedComponents = [];\nlet Contexts = [];\n\n/**\n * Handle action\n * @param {TinyMCE} editor\n */\nexport const handleAction = (editor) => {\n    userStudent = isStudent(editor);\n    previewC4L = showPreview(editor);\n    allowedComponents = getallowedComponents(editor);\n    loadVariantPreferences().then(displayDialogue(editor));\n};\n\n/**\n * Display modal\n * @param  {TinyMCE} editor\n */\nconst displayDialogue = async(editor) => {\n    const data = Object.assign({}, {});\n\n    // Show modal with buttons.\n    const modal = await ModalFactory.create({\n        type: C4LModal.TYPE,\n        templateContext: await getTemplateContext(editor, data),\n        large: true,\n    });\n\n    // Set modal size when no preview.\n    if (!previewC4L) {\n        editor.targetElm.closest('body').classList.add('c4l-modal-no-preview');\n    }\n    modal.show();\n\n    // Event modal listener.\n    modal.getRoot().on(ModalEvents.hidden, () => {\n        handleModalHidden(editor);\n    });\n\n    // Event filters listener.\n    const filters = modal.getRoot()[0].querySelectorAll('.c4l-button-filter');\n    filters.forEach(node => {\n        node.addEventListener('click', (event) => {\n            handleButtonFilterClick(event, modal);\n        });\n    });\n\n    modal.getRoot()[0].querySelector('.c4l-select-filter').addEventListener('change', (event) => {\n       handleSelectFilterChange(event, modal);\n    });\n\n    // Event buttons listeners.\n    const buttons = modal.getRoot()[0].querySelectorAll('.c4lt-dialog-button');\n    buttons.forEach(node => {\n        node.addEventListener('click', (event) => {\n            handleButtonClick(event, editor, modal);\n        });\n        if (previewC4L) {\n            node.addEventListener('mouseenter', (event) => {\n                handleButtonMouseEvent(event, modal, true);\n            });\n            node.addEventListener('mouseleave', (event) => {\n                handleButtonMouseEvent(event, modal, false);\n            });\n        }\n    });\n\n    // Event variants listeners.\n    const variants = modal.getRoot()[0].querySelectorAll('.c4l-button-variant');\n    variants.forEach(node => {\n        node.addEventListener('click', (event) => {\n            handleVariantClick(event, modal);\n        });\n        if (previewC4L) {\n            node.addEventListener('mouseenter', (event) => {\n                handleVariantMouseEvent(event, modal, true);\n            });\n            node.addEventListener('mouseleave', (event) => {\n                handleVariantMouseEvent(event, modal, false);\n            });\n        }\n    });\n};\n\n/**\n * Handle a change within filter select.\n *\n * @param {MouseEvent} event The change event\n * @param {obj} modal\n */\nconst handleSelectFilterChange = (event, modal) => {\n    const select = event.target.closest('select');\n\n    if (select) {\n        const currentContext = select.value;\n        if (Contexts.indexOf(currentContext) !== -1) {\n            // Select current button.\n            const buttons = modal.getRoot()[0]\n                .querySelectorAll('.c4l-buttons-filters button');\n            buttons.forEach(node => node.classList.remove('c4l-button-filter-enabled'));\n            const button = modal.getRoot()[0]\n                .querySelector('.c4l-button-filter[data-filter=\"' + currentContext + '\"]');\n            button.classList.add('c4l-button-filter-enabled');\n\n            // Show/hide component buttons.\n            showContextButtons(modal, currentContext);\n        }\n    }\n};\n\n/**\n * Handle a click within filter button.\n *\n * @param {MouseEvent} event The change event\n * @param {obj} modal\n */\nconst handleButtonFilterClick = (event, modal) => {\n    const button = event.target.closest('button');\n\n    const currentContext = button.dataset.filter;\n    // Filter button.\n    if (Contexts.indexOf(currentContext) !== -1) {\n        // Select current button.\n        const buttons = modal.getRoot()[0].querySelectorAll('.c4l-buttons-filters button');\n        buttons.forEach(node => node.classList.remove('c4l-button-filter-enabled'));\n        button.classList.add('c4l-button-filter-enabled');\n\n        // Select current option in select.\n        const select = modal.getRoot()[0].querySelector('.c4l-select-filter');\n        select.selectedIndex = Contexts.indexOf(currentContext);\n\n        // Show/hide component buttons.\n        showContextButtons(modal, currentContext);\n    }\n};\n\n/**\n * Handle when closing the Modal.\n *\n * @param {obj} editor\n */\nconst handleModalHidden = (editor) => {\n    editor.targetElm.closest('body').classList.remove('c4l-modal-no-preview');\n    saveVariantPreferences();\n};\n\n/**\n * Handle a click in a component button.\n *\n * @param {MouseEvent} event The click event\n * @param {obj} editor\n * @param {obj} modal\n */\nconst handleButtonClick = (event, editor, modal) => {\n    const selectedButton = event.target.closest('button').dataset.id;\n\n    // Component button.\n    if (Components?.[selectedButton]) {\n        const sel = editor.selection.getContent();\n        let componentCode = Components[selectedButton].code;\n        const placeholder = (sel.length > 0 ? sel : Components[selectedButton].text);\n\n        // Create a new node to replace the placeholder.\n        const timestamp = new Date().getTime();\n        const randomId = Math.round(Math.random() * 100000) + '-' + timestamp;\n        const newNode = document.createElement('span');\n        newNode.dataset.id = randomId;\n        newNode.innerHTML = placeholder;\n        componentCode = componentCode.replace('{{PLACEHOLDER}}', newNode.outerHTML);\n\n        // Return active variants for current component.\n        const variants = getVariants(Components[selectedButton].name);\n\n        // Apply variants to html component.\n        if (variants.length > 0) {\n            componentCode = componentCode.replace('{{VARIANTS}}', variants.join(' '));\n        } else {\n            componentCode = componentCode.replace('{{VARIANTS}}', '');\n        }\n\n        // Sets new content.\n        editor.selection.setContent(componentCode);\n\n        // Select text.\n        const nodeSel = editor.dom.select('span[data-id=\"' + randomId + '\"]');\n        if (nodeSel?.[0]) {\n            editor.selection.select(nodeSel[0]);\n        }\n\n        modal.destroy();\n        editor.focus();\n    }\n};\n\n/**\n * Handle a mouse events mouseenter/mouseleave in a component button.\n *\n * @param {MouseEvent} event The click event\n * @param {obj} modal\n * @param {bool} show\n */\nconst handleButtonMouseEvent = (event, modal, show) => {\n    const selectedButton = event.target.closest('button').dataset.id;\n    const node = modal.getRoot()[0].querySelector('div[data-id=\"code-preview-' + selectedButton + '\"]');\n    const previewDefault = modal.getRoot()[0].querySelector('div[data-id=\"code-preview-default\"]');\n\n    if (node) {\n        if (show) {\n            previewDefault.classList.toggle('c4l-hidden');\n            node.classList.toggle('c4l-hidden');\n        } else {\n            node.classList.toggle('c4l-hidden');\n            previewDefault.classList.toggle('c4l-hidden');\n        }\n    }\n};\n\n/**\n * Handle a mouse events mouseenter/mouseleave in a variant button.\n *\n * @param {MouseEvent} event The mouseenter/mouseleave event\n * @param {obj} modal\n * @param {bool} show\n */\nconst handleVariantMouseEvent = (event, modal, show) => {\n    const variant = event.target.closest('span');\n    const variantEnabled = variant.dataset.state == 'on';\n    const button = event.target.closest('button');\n\n    if (!variantEnabled) {\n        updateVariantComponentState(variant, button, modal, show, false);\n    }\n};\n\n\n/**\n * Handle a mouse event within the variant buttons.\n *\n * @param {MouseEvent} event The mouseenter/mouseleave event\n * @param {obj} modal\n */\nconst handleVariantClick = (event, modal) => {\n    event.stopPropagation();\n    const variant = event.target.closest('span');\n    const button = event.target.closest('button');\n    updateVariantComponentState(variant, button, modal, false, true);\n};\n\n/**\n * Get the template context for the dialogue.\n *\n * @param {Editor} editor\n * @param {object} data\n * @returns {object} data\n */\nconst getTemplateContext = async(editor, data) => {\n    return Object.assign({}, {\n        elementid: editor.id,\n        buttons: await getButtons(editor),\n        filters: await getFilters(),\n        preview: previewC4L,\n    }, data);\n};\n\n/**\n * Get the C4L filters for the dialogue.\n *\n * @returns {object} data\n */\nconst getFilters = async() => {\n    const filters = [];\n    const stringValues = await getStrings(Contexts.map((key) => ({key, component})));\n\n    // Iterate over contexts.\n    Contexts.map((context, index) => {\n        filters.push({\n            name: stringValues[index],\n            type: context,\n            filterClass: index === 0 ? 'c4l-button-filter-enabled' : '',\n        });\n    });\n\n    return filters;\n};\n\n/**\n * Get the C4L buttons for the dialogue.\n *\n * @param {Editor} editor\n * @returns {object} buttons\n */\nconst getButtons = async(editor) => {\n    const buttons = [];\n    const strings = await getAllStrings();\n    const sel = editor.selection.getContent();\n    let componentCode = '';\n    let placeholder = '';\n    let variants = [];\n\n    // Iterate over components.\n    Components.map((component, index) => {\n        if (!userStudent || (userStudent && allowedComponents.includes(component.name))) {\n            if (previewC4L) {\n                placeholder = (sel.length > 0 ? sel : component.text);\n                componentCode = component.code;\n                componentCode = componentCode.replace('{{PLACEHOLDER}}', placeholder);\n                // Return active variants for component.\n                variants = getVariants(component.name);\n\n                // Apply class variants to html component.\n                if (variants.length > 0) {\n                    componentCode = componentCode.replace('{{VARIANTS}}', variants.join(' '));\n                } else {\n                    componentCode = componentCode.replace('{{VARIANTS}}', '');\n                }\n            }\n\n            // Save contexts.\n            if (Contexts.indexOf(component.type) === -1) {\n                Contexts.push(component.type);\n            }\n\n            buttons.push({\n                id: index,\n                name: strings.get(component.name),\n                type: component.type,\n                imageClass: component.imageClass,\n                classComponent: component.imageClass.replace('-icon', ''),\n                htmlcode: componentCode,\n                variants: getVariantsState(component.name, component.variants, strings),\n            });\n\n            // Add class to hide button.\n            if (Contexts.indexOf(component.type) !== 0) {\n                buttons[buttons.length - 1].imageClass += ' c4l-hidden';\n            }\n        }\n    });\n\n    return buttons;\n};\n\n/**\n * Get variants for the dialogue.\n * @param  {string} component\n * @param  {object} elements\n * @param  {object} strings\n * @return {object} Variants for a component\n */\nconst getVariantsState = (component, elements, strings) => {\n    const variants = [];\n    let variantState = '';\n    let variantClass = '';\n\n    // Max 3 variants.\n    if (elements.length > 3) {\n        elements = elements.slice(0, 2);\n    }\n\n    elements.map((variant, index) => {\n        if (variantExists(component, variant)) {\n            variantState = 'on';\n            variantClass = 'on ';\n        } else {\n            variantState = 'off';\n            variantClass = '';\n        }\n        variantClass += variant + '-variant-' + variantState;\n        variants.push({\n            id: index,\n            name: variant,\n            state: variantState,\n            imageClass: variantClass,\n            title: strings.get(variant),\n        });\n    });\n\n    return variants;\n};\n\n/**\n * Update a variant component UI.\n *\n * @param {obj} variant\n * @param {obj} button\n * @param {obj} modal\n * @param {bool} show\n * @param {bool} updateHtml\n */\nconst updateVariantComponentState = (variant, button, modal, show, updateHtml) => {\n    const selectedVariant = 'c4l-' + variant.dataset.variant + '-variant';\n    const selectedButton = button.dataset.id;\n    const componentClass = button.dataset.classcomponent;\n    const previewComponent = modal.getRoot()[0]\n        .querySelector('div[data-id=\"code-preview-' + selectedButton + '\"] .' + componentClass);\n\n    if (previewComponent) {\n        if (updateHtml) {\n            if (variant.dataset.state == 'on') {\n                removeVariant(Components[selectedButton].name, variant.dataset.variant);\n                variant.dataset.state = 'off';\n                variant.classList.remove(variant.dataset.variant + '-variant-on');\n                variant.classList.add(variant.dataset.variant + '-variant-off');\n                variant.classList.remove('on');\n                previewComponent.classList.remove(selectedVariant);\n            } else {\n                addVariant(Components[selectedButton].name, variant.dataset.variant);\n                variant.dataset.state = 'on';\n                variant.classList.remove(variant.dataset.variant + '-variant-off');\n                variant.classList.add(variant.dataset.variant + '-variant-on');\n                variant.classList.add('on');\n                previewComponent.classList.add(selectedVariant);\n            }\n        } else {\n            if (show) {\n                previewComponent.classList.add(selectedVariant);\n            } else {\n                previewComponent.classList.remove(selectedVariant);\n            }\n        }\n    }\n};\n\n/**\n * Show/hide buttons depend on selected context.\n * @param  {object} modal\n * @param  {String} context\n */\nconst showContextButtons = (modal, context) => {\n    const showNodes = modal.getRoot()[0].querySelectorAll('button[data-type=\"' + context + '\"]');\n    const hideNodes = modal.getRoot()[0].querySelectorAll('button[data-type]:not([data-type=\"' + context + '\"])');\n\n    showNodes.forEach(node => node.classList.remove('c4l-hidden'));\n    hideNodes.forEach(node => node.classList.add('c4l-hidden'));\n};\n\n/**\n * Get language strings.\n *\n * @return {object} Language strings\n */\nconst getAllStrings = async() => {\n    const keys = [];\n\n    Components.map(element => {\n        keys.push(element.name);\n        element.variants.map(variant => {\n            if (keys.indexOf(variant) === -1) {\n                keys.push(variant);\n            }\n        });\n    });\n\n    const stringValues = await getStrings(keys.map((key) => ({key, component})));\n    return new Map(keys.map((key, index) => ([key, stringValues[index]])));\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","_modal","_modal_factory","_modal_events","userStudent","previewC4L","allowedComponents","Contexts","_exports","handleAction","editor","isStudent","showPreview","getallowedComponents","loadVariantPreferences","then","displayDialogue","async","data","Object","assign","modal","ModalFactory","create","type","C4LModal","TYPE","templateContext","getTemplateContext","large","targetElm","closest","classList","add","show","getRoot","on","ModalEvents","hidden","handleModalHidden","querySelectorAll","forEach","node","addEventListener","event","handleButtonFilterClick","querySelector","handleSelectFilterChange","handleButtonClick","handleButtonMouseEvent","handleVariantClick","handleVariantMouseEvent","select","target","currentContext","value","indexOf","remove","showContextButtons","button","dataset","filter","selectedIndex","saveVariantPreferences","selectedButton","id","Components","components","sel","selection","getContent","componentCode","code","placeholder","length","text","timestamp","Date","getTime","randomId","Math","round","random","newNode","document","createElement","innerHTML","replace","outerHTML","variants","getVariants","name","join","setContent","nodeSel","dom","destroy","focus","previewDefault","toggle","variant","variantEnabled","state","updateVariantComponentState","stopPropagation","elementid","buttons","getButtons","filters","getFilters","preview","stringValues","getStrings","map","key","component","context","index","push","filterClass","strings","getAllStrings","includes","get","imageClass","classComponent","htmlcode","getVariantsState","elements","variantState","variantClass","slice","variantExists","title","updateHtml","selectedVariant","componentClass","classcomponent","previewComponent","removeVariant","addVariant","showNodes","hideNodes","keys","element","Map"],"mappings":"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"}