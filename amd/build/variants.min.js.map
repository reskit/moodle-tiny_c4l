{"version":3,"file":"variants.min.js","sources":["../src/variants.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Variants helper for C4L plugin.\n *\n * @module      tiny_c4l/variants\n * @copyright   2023 Marc Catal√† <reskit@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport {components as COMPONENTS} from './components';\n\nconst VARIANTS = [\n    { id: 0, name: \"align-center\" },\n    { id: 1, name: \"align-left\" },\n    { id: 2, name: \"align-right\" },\n    { id: 3, name: \"caption\" },\n    { id: 4, name: \"comfort-reading\" },\n    { id: 5, name: \"dont-card-only\" },\n    { id: 6, name: \"full-width\" },\n    { id: 7, name: \"ordered-list\" },\n    { id: 8, name: \"quote\" },\n];\nconst variantsPreferenceName = 'c4l_components_variants';\nlet variantPreferences = {};\n\nexport const loadVariantPreferences = async() => {\n\n    const request = {\n        methodname: 'core_user_get_user_preferences',\n        args: {\n            name: variantsPreferenceName\n        }\n    };\n\n    return Ajax.call([request])[0]\n        .then(result => {\n            let comp = {};\n            let rawPreferences = {};\n            let variantObj = {};\n            try {\n                rawPreferences = JSON.parse(result.preferences[0].value);\n            } catch(e) {\n                Notification.exception(e);\n            }\n\n            if (rawPreferences !== null) {\n                Object.keys(rawPreferences).forEach(preference => {\n                    comp = COMPONENTS.find(component => component.id == preference);\n                    if (comp != undefined) {\n                        variantPreferences[comp.name] = [];\n                        rawPreferences[preference].map((variant) => {\n                            variantObj = VARIANTS.find(element => element.id == variant);\n                            if (variantObj != undefined) {\n                                variantPreferences[comp.name].push(variantObj.name);\n                            }\n                        });\n                    }\n                });\n            }\n    }).catch(Notification.exception);\n};\n\nexport const saveVariantPreferences = () => {\n    let comp = {};\n    let rawPreferences = {};\n    let variantObj = {};\n    Object.keys(variantPreferences).forEach(preference => {\n        comp = COMPONENTS.find(component => component.name == preference);\n        if (comp != undefined) {\n            rawPreferences[comp.id] = [];\n            variantPreferences[preference].map((variant) => {\n                variantObj = VARIANTS.find(element => element.name == variant);\n                if (variantObj != undefined) {\n                    rawPreferences[comp.id].push(variantObj.id);\n                }\n            });\n        }\n    });\n\n    const request = {\n        methodname: 'core_user_update_user_preferences',\n        args: {\n            preferences: [\n                {\n                    type: variantsPreferenceName,\n                    value: JSON.stringify(rawPreferences)\n                }\n            ]\n        }\n    };\n\n    return Ajax.call([request])[0].catch(Notification.exception);\n};\n\n\nexport const variantExists = (component, variant) => {\n    return variantPreferences?.[component] && variantPreferences[component].indexOf(variant) !== -1;\n};\n\nexport const getVariants = (component) => {\n    let variants = [];\n\n    if (variantPreferences?.[component]) {\n        variantPreferences[component].map(variant => {\n            variants.push('c4l-' + variant + '-variant');\n        });\n    }\n    return variants;\n};\n\nexport const addVariant = (component, variant) => {\n    if (!variantPreferences?.[component]) {\n        variantPreferences[component] = [];\n    }\n    if (!variantExists(component, variant)) {\n        variantPreferences[component].push(variant);\n    }\n};\n\nexport const removeVariant = (component, variant) => {\n    const index = variantPreferences[component].indexOf(variant);\n    if (index !== -1) {\n        delete variantPreferences[component][index];\n    }\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","_ajax","_notification","VARIANTS","id","name","variantPreferences","_exports","loadVariantPreferences","async","request","methodname","args","Ajax","call","then","result","comp","rawPreferences","variantObj","JSON","parse","preferences","value","e","Notification","exception","Object","keys","forEach","preference","COMPONENTS","find","component","undefined","map","variant","element","push","catch","saveVariantPreferences","type","stringify","variantExists","indexOf","getVariants","variants","addVariant","removeVariant","index"],"mappings":"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"}